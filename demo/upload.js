!function(a,b,c,d){var e=function(b,c){this.$element=b,this.defaults={c_id:"",input_id:"",c_url:"",extensions:"",number:0,singleRepeat:!1,text:!1},this.options=a.extend({},this.defaults,c)};e.prototype={getUploader:function(){var b=this.options.c_id,c=this.options.input_id,d=this.options.c_url,f=this.options.extensions,g=this.options.number,h=this.options.singleRepeat,i=this.options.text,j=f||"jpg,jpeg,gif,png",k=new plupload.Uploader({runtimes:"html5,flash,silverlight",browse_button:b,max_file_size:"2mb",url:d,flash_swf_url:"resource/js/Moxie.swf",silverlight_xap_url:"resource/js/Moxie.xap",filters:[{title:"图片（"+j+"）",extensions:j},{title:"video files",extensions:"flv,mp4,avi,ts"}],init:{FilesAdded:function(a,b){b.length>1?JQbox.alert("只能上传一个文件哦"):a.start()},FileUploaded:function(d,f,j){if(j.response){h&&a.each(d.files,function(c,e){a("#"+b).parent(".upload-container").find(".img_up").remove(),d.files.length<=1||d.removeFile(e)});var k=g;if(k>0){var l=a("#"+b).parent(".upload-container").find(".img_up").length;if(l+1>=k&&a("#"+b).hide(),l>=k)return!1}var m=c+(1==k||h?"":"[]"),n='<span class="img_up">';n=n+'<img src="'+golddiy_image_path+j.response+'">',n=n+'<input type="hidden" name="'+m+'" value="'+j.response+'">',1!=h&&(n+='<a class="del_img" href="javascript:;">删除</a>'),i&&(n+='<input type="text" class="wei-up-inp" placeholder="祈福人姓名"/>'),n+="</span>",a("#"+b).siblings(".img_ul").append(n),a(".del_img").hide(),this.refresh(),d=new e,d.binddel(b,g)}else alert("上传失败，请重试")},UploadProgress:function(a,b){b.id,b.percent},Error:function(a,b){JQbox.alert(b.message)}}});return k},start:function(a){a.init(),this.binddel(this.options.c_id,this.options.number)},binddel:function(b,c){var d=a("#c_id").parent(".upload-container").find(".img_up").length;a(".del_img").on("click",function(){var b=a(this).parent().parent().siblings(".img_add");"none"==b.css("display")&&b.show(),a(this).parent().remove()}),a(".img_up").hover(function(){a(this).find(".del_img").show()},function(){a(this).find(".del_img").hide()}),d>0&&d>=c&&a("#"+b).hide()}},a.fn.uploads=function(a){var b=new e(this,a);b.getUploader().init(),b.binddel()}}(jQuery,window,document);